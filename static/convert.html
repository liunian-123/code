<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrjs@0.1.2/qr.min.js"></script>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        #app {
            position: relative;
        }

        .bg {
            position: absolute;
            z-index: 1;
        }

        .el {
            position: absolute;
            z-index: 2;
            white-space: nowrap;
        }
    </style>
    <script>
        var data = {
            //原价 

            // "bg": {
            //     "width": 1242,
            //     "height": 2209,
            //     //带有价格的背景
            //     // "imgUrl": "https://static001.geekbang.org/resource/image/55/ba/555c92035085ce6660ae8e53a89a55ba.png"
            //     //不带价格的背景
            //     "imgUrl":"https://static001.geekbang.org/resource/image/15/d8/1520a1011156226f7173492f98dbe5d8.png"
            // },
            // "els":[
            //     {
            //         "type":"text",
            //         "fontSize":126,
            //         "fontColor":713529,
            //         "x":60,
            //         "y":1843,
            //         "fontWeight":300,
            //         "lineHeight":126,
            //         "width":800,
            //         "text":"￥"
            //     },
            //     {
            //         "type":"text",
            //         "fontSize":126,
            //         "fontColor":713529,
            //         "x":167,
            //         "y":1843,
            //         "fontWeight":300,
            //         "lineHeight":126,
            //         "width":800,
            //         "text":"68"
            //     },
            //     {
            //         "type":"text",
            //         "fontSize":54,
            //         "fontColor":713529,
            //         "x":325,
            //         "y":1899,
            //         "fontWeight":300,
            //         "lineHeight":54,
            //         "text":"/"
            //     },
            //     {
            //         "type":"text",
            //         "isLength": true,
            //         "fontSize":68,
            //         "fontColor":713529,
            //         "x":363,
            //         "y":1891,
            //         "fontWeight":300,
            //         "lineHeight":68,
            //         "text":"141"
            //     },
            //     {
            //         "type":"text",
            //         "fontSize":57,
            //         "fontColor":713529,    
            //         "x":443,
            //         "y":1898,
            //         "fontWeight":300,
            //         "lineHeight":57,
            //         "width":800,
            //         "text":"期"
            //     },
            // {
            //         "type":"text",
            //         "background":574166,
            //         "paddingtop":17,
            //         "paddingleft":30,
            //         "radius":10,
            //         "fontSize":51,
            //         "fontColor":'d4ceda',
            //         "x":88,
            //         "y":2033,
            //         "fontWeight":300,
            //         "lineHeight":51,
            //         "width":500,
            //         "text":"新人专享，仅需￥19.9"
            //     }
            // ]
            
            // 优惠

            "bg": {
                "width": 1242,
                "height": 2209,
                //带有价格的背景
                // "imgUrl": "https://static001.geekbang.org/resource/image/c7/74/c79b5094131fd4a4478bed3a673ccd74.png"
                //不带价格的背景
                "imgUrl":"https://static001.geekbang.org/resource/image/15/d8/1520a1011156226f7173492f98dbe5d8.png"

            },
            "els": [
                {
                    "type": "text",
                    "fontSize": 61,
                    "fontColor": 713529,
                    "x": 89,
                    "y": 1836,
                    "fontWeight": 300,
                    "lineHeight": 61,
                    "width": 800,
                    "text": "原价"
                },
                {
                    "type": "text",
                    "fontSize": 61,
                    "fontColor": 713529,
                    "x": 201,
                    "y": 1836,
                    "fontWeight": 300,
                    "lineHeight": 61,
                    "width": 800,
                    "text": "￥"
                }, {
                    "type": "text",
                    "fontSize": 61,
                    "fontColor": 713529,
                    "x": 252,
                    "y": 1836,
                    "fontWeight": 300,
                    "lineHeight": 61,
                    "width": 800,
                    "text": "68"
                },
                {
                    "type": "text",
                    "isLengthVar": true,
                    "fontSize": 85,
                    "fontColor": 713529,
                    "x": 83,
                    "y": 1918,
                    "fontWeight": 300,
                    "lineHeight": 85,
                    "text": "早鸟优"
                },
                {
                    "type": "text",
                    "fontSize": 112,
                    "fontColor": 'e9531e',
                    "x": 407,
                    "y": 1904,
                    "fontWeight": 300,
                    "lineHeight": 112,
                    "width": 800,
                    "text": "￥"
                },
                {
                    "type": "text",
                    "fontSize": 110,
                    "fontColor": 'e9531e',
                    "x": 492,
                    "y": 1904,
                    "fontWeight": 300,
                    "lineHeight": 110,
                    "width": 800,
                    "text": "55"
                },
                {
                    "type":"text",
                    "background":'574166',
                    "paddingtop":17,
                    "paddingleft":30,
                    "radius":10,
                    "fontSize":51,
                    "fontColor":'d4ceda',
                    "x":88,
                    "y":2033,
                    "fontWeight":300,
                    "lineHeight":51,
                    "width":500,
                    "text":"新人专享，仅需￥19.9"
                }
            ]
        }
    </script>
    <title>极客时间</title>
</head>

<body>
    <div id="app">
        <!-- <custom-text></custom-text>
    <custom-img></custom-img>
    <custom-qrcode></custom-qrcode> -->
    </div>
    <script>
        // 背景图组件
        Vue.component('custom-bg', {
            props: {
                data: {
                    type: Object
                },
            },
            data: function () {
                console.log(this, '333')
                return {
                    style: {
                        width: (this.data.width || 750) + 'px',
                        height: (this.data.height || 900) + 'px'
                    }
                }
            },
            template: '<img class="bg" :src="data.imgUrl" :style="style">'
        })

        // Text 组件
        Vue.component('custom-text', {
            props: {
                data: {
                    type: Object,
                    default: function () {
                        return {
                            x: 0,
                            y: 0,
                            fontSize: 14,
                            fontSize: '000',
                            width: 'auto',
                            text: '默认文字'
                        }
                    }
                }
            },
            data: function () {
                return {
                    style: {
                        left: (this.data.x || 0) + 'px',
                        top: (this.data.y || 0) + 'px',
                        fontSize: (this.data.fontSize || 12) + 'px',
                        fontWeight: (this.data.fontWeight || 400) + 'px',
                        lineHeight: (this.data.lineHeight || 1)+'px',
                        color: ('#' + this.data.fontColor || 'transparent'),
                        background: ('#' + this.data.background || 'transparent'),
                        paddingTop:(this.data.paddingtop)+'px',
                        paddingLeft:(this.data.paddingleft)+'px',
                        paddingRight:(this.data.paddingleft)+'px',
                        paddingBottom:(this.data.paddingtop)+'px',
                        borderRadius:(this.data.radius)+'px',
                        width: (typeof this.data.width == 'string' ? this.data.width : (this.data.width) + 'px')
                    }
                }
            },
            template: '<div class="el" :style="style">{{ data.text }}</div>'
        })
        // 图片组件
        Vue.component('custom-img', {
            props: {
                data: {
                    type: Object,
                    default: function () {
                        return {
                            x: 0,
                            y: 0,
                            fontSize: 14,
                            fontSize: '000',
                            width: 100,
                            height: 100,
                            roundMask: false,
                            imgUrl: 'http://www.gravatar.com/avatar/404619a19ab0695def367dc109d5cdc4?s=72&d=identicon',
                            text: '默认文字'
                        }
                    }
                }
            },
            data: function () {
                return {
                    style: {
                        left: (this.data.x || 0) + 'px',
                        top: (this.data.y || 0) + 'px',
                        width: (this.data.width || 100) + 'px',
                        height: (this.data.height || 100) + 'px',
                        borderRadius: this.data.roundMask || false ? '50%' : 0
                    }
                }
            },
            template: '<img class="el" :src="data.imgUrl" :style="style" z-index=-1>'
        })
        // 二维码组件
        Vue.component('custom-qrcode', {
            props: {
                data: {
                    type: Object,
                    default: function () {
                        return {
                            x: 0,
                            y: 0,
                            size: 100,
                            text: '默认文字'
                        }
                    }
                }
            },
            data: function () {
                return {
                    style: {
                        left: (this.data.x || 0) + 'px',
                        top: (this.data.y || 0) + 'px',
                        width: (this.data.size || 100) + 'px',
                        height: (this.data.size || 100) + 'px'
                    },
                    qrContent: QRCode.generatePNG(this.data.text, { margin: 2, ecclevel: 'L' })
                }
            },
            template: '<img class="el" :style="style" :src="qrContent"></div>'
        })
        var app = new Vue({
            el: '#app',
            data() {
                return {
                    data
                }
            },
            created() {
                console.log(this.data)
            },
            methods: {
                getVarDom () {
                    const varDom = document.querySelector('.is-width-var')
                    if(!varDom) return
                    let domWidth = varDom.clientWidth
                    let domLeft = varDom.offsetLeft
                    if (varDom.parentNode.nextSibling &&  varDom.parentNode.nextSibling.childNodes && varDom.parentNode.nextSibling.childNodes[0]) {
                        var nextDom = varDom.parentNode.nextSibling.childNodes[0]
                        nextDom.style.left = `${domLeft + domWidth - 16}px`
                    }
                    if (varDom.parentNode.nextSibling && varDom.parentNode.nextSibling.nextSibling&& varDom.parentNode.nextSibling.nextSibling.childNodes && varDom.parentNode.nextSibling.nextSibling.childNodes[0]) {
                        var nexttwoDom = varDom.parentNode.nextSibling.nextSibling.childNodes[0]
                        nexttwoDom.style.left = `${domLeft + domWidth + 70}px`
                        console.log(nexttwoDom,domWidth)
                    }
                    
                },
                getVarDomYuan(){
                    const varDomyuan = document.querySelector('.is-width')
                    if(!varDomyuan) return
                    let domWidthyuan = varDomyuan.clientWidth
                    let domLeftyuan = varDomyuan.offsetLeft
                    if (varDomyuan.parentNode.nextSibling && varDomyuan.parentNode.nextSibling.childNodes && varDomyuan.parentNode.nextSibling.childNodes[0]) {
                        var nextDomyuan = varDomyuan.parentNode.nextSibling.childNodes[0]
                        nextDomyuan.style.left = `${domLeftyuan + domWidthyuan +10}px`
                        console.log(domWidthyuan,domLeftyuan)

                    }
                }
            },
            mounted () {
                this.getVarDom(),
                this.getVarDomYuan()
            },
            template:
                '<div>' +
                '<custom-bg :data="data.bg"></custom-bg>' +
                '<div v-for="(item, index) in data.els" :key="index">' +
                '<custom-text :class="{ \'is-width-var\': item.isLengthVar, \'is-width\': item.isLength}" v-if="item.type == \'text\'" :data="item"></custom-text>' +
                '<custom-img v-else-if="item.type == \'img\'" :data="item"></custom-img>' +
                '<custom-qrcode v-else-if="item.type == \'qrcode\'" :data="item"></custom-qrcode>' +
                '</div>' +
                '</div>'
        })
    </script>
</body>

</html>