<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrjs@0.1.2/qr.min.js"></script>
    <style>
        * {
            padding: 0;
            margin: 0;
        }
        #app {
            position: relative;
        }
        .bg {
            position: absolute;
            z-index: 1;
        }
        .el {
            position: absolute;
            z-index: 2;
        }
    </style>
    <script>
        var data = {
          bg: {
            imgUrl: 'https://static001.geekbang.org/resource/image/f4/f8/f472e18fe241d8539ffc351bff3d69f8.jpg',
            width: 500,
            height:900
          },
          els:[
            {
              type:'text',
              text:'￥99',
              x:'100',
              y:'100',
              fontSize:'16',
              fontWeight:'200'

            }
          ]
        }
    </script>
    <title>极客时间</title>
</head>
<body>
<div id="app">
    <!-- <custom-text></custom-text>
    <custom-img></custom-img>
    <custom-qrcode></custom-qrcode> -->
</div>
<script>
    // 背景图组件
    Vue.component('custom-bg', {
        props: {
            data: {
                type: Object
            },
        },
        data: function () {
          console.log(this, '333')
            return {
                style: {
                    width: (this.data.width || 750) + 'px',
                    height: (this.data.height || 900) + 'px'
                }
            }
        },
        template: '<img class="bg" :src="data.imgUrl" :style="style">'
    })

    // Text 组件
    Vue.component('custom-text', {
        props: {
            data: {
                type: Object,
                default: function () {
                    return {
                        x: 0,
                        y: 0,
                        fontSize: 14,
                        fontSize: '000',
                        width: 'auto',
                        text: '默认文字'
                    }
                }
            }
        },
        data: function () {
            return {
                style: {
                    left: (this.data.x || 0) + 'px',
                    top: (this.data.y || 0) + 'px',
                    fontSize: (this.data.fontSize || 12) + 'px',
                    fontWeight: (this.data.fontWeight || 400) + 'px',
                    lineHeight: (this.data.lineHeight || 1),
                    color: '#' + (this.data.fontColor || '000'),
                    width: (typeof this.data.width == 'string' ? this.data.width : (this.data.width || 0) + 'px')
                }
            }
        },
        template: '<div class="el" :style="style">{{ data.text }}</div>'
    })
    // 图片组件
    Vue.component('custom-img', {
        props: {
            data: {
                type: Object,
                default: function () {
                    return {
                        x: 0,
                        y: 0,
                        fontSize: 14,
                        fontSize: '000',
                        width: 100,
                        height: 100,
                        roundMask: false,
                        imgUrl: 'http://www.gravatar.com/avatar/404619a19ab0695def367dc109d5cdc4?s=72&d=identicon',
                        text: '默认文字'
                    }
                }
            }
        },
        data: function () {
            return {
                style: {
                    left: (this.data.x || 0) + 'px',
                    top: (this.data.y || 0) + 'px',
                    width: (this.data.width || 100) + 'px',
                    height: (this.data.height || 100) + 'px',
                    borderRadius: this.data.roundMask || false ? '50%' : 0
                }
            }
        },
        template: '<img class="el" :src="data.imgUrl" :style="style">'
    })
    // 二维码组件
    Vue.component('custom-qrcode', {
        props: {
            data: {
                type: Object,
                default: function () {
                    return {
                        x: 0,
                        y: 0,
                        size: 100,
                        text: '默认文字'
                    }
                }
            }
        },
        data: function () {
            return {
                style: {
                    left: (this.data.x || 0) + 'px',
                    top: (this.data.y || 0) + 'px',
                    width: (this.data.size || 100) + 'px',
                    height: (this.data.size || 100) + 'px'
                },
                qrContent: QRCode.generatePNG(this.data.text, {margin: 2, ecclevel: 'L'})
            }
        },
        template: '<img class="el" :style="style" :src="qrContent"></div>'
    })
    var app = new Vue({
        el: '#app',
        data () {
          return {
            data
          }
        },
        created () {
          console.log(this.data)
        },
        template:
            '<div>' +
            '<custom-bg :data="data.bg"></custom-bg>' +
            '<div v-for="(item, index) in data.els" :key="index">' +
            '<custom-text v-if="item.type == \'text\'" :data="item"></custom-text>' +
            '<custom-img v-else-if="item.type == \'img\'" :data="item"></custom-img>' +
            '<custom-qrcode v-else-if="item.type == \'qrcode\'" :data="item"></custom-qrcode>' +
            '</div>' +
            '</div>'
    })
</script>
</body>
</html>
